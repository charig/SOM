# Config file for ReBench
# Config format is YAML (see http://yaml.org/ for detailed spec)

# this run definition will be choosen if no parameters are given to rebench.py
standard_experiment: all
standard_data_file: 'mateV2.data'

runs:
    number_of_data_points: 100

# settings and requirements for statistic evaluation
# Note, this is only used for explorative runs, for the final experiments, we
# rely soley on a fixed configuration of data points.
statistics:
    confidence_level: 0.95
 
# settings for quick runs, useful for fast feedback during experiments
quick_runs:
    number_of_data_points: 3
    max_time: 60   # time in seconds

# definition of benchmark suites
benchmark_suites:
    macro-steady:
        gauge_adapter: RebenchLog
        command: &MACRO_CMD ":Examples/Benchmarks/LanguageFeatures:Examples/Benchmarks/Json:Examples/Benchmarks/Richards:Examples/Benchmarks/DeltaBlue:Examples/Benchmarks/NBody:Examples/Benchmarks/GraphSearch Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s"
        max_runtime: 60000
        benchmarks: &MACRO_STEADY
            - Richards:
                extra_args: "1500 0 20"
            - DeltaBlue:
                extra_args: "1500 0 1200"
            - Mandelbrot:
                extra_args: "1500 0 500"
            - NBody:
                extra_args: "1500 0 50000"
            - Json:
                extra_args: "1500 0 50"
            - GraphSearch:
                extra_args: "1500 0 30"
            - PageRank:
                extra_args: "1500 0 1000"
        variable_values: &INLINING_VALUES
            - 1500
            - 2500
            - 3500
            - 4000
            - 6000
            - 8000
            
    macro-steady-interp:
        gauge_adapter: RebenchLog
        command: *MACRO_CMD
        max_runtime: 60000
        benchmarks:
            - Richards:
                extra_args: "200 0 1"
            - DeltaBlue:
                extra_args: "200 0 600"
            - Mandelbrot:
                extra_args: "200 0 80"
            - NBody:
                extra_args: "200 0 2500"
            - Json:
                extra_args: "200 0 20"
            - GraphSearch:
                extra_args: "200 0 15"
            - PageRank:
                extra_args: "200 0 300"
                                                                                         

    micro-steady:
        gauge_adapter: RebenchLog
        command: &MICRO_CMD ":Examples/Benchmarks/LanguageFeatures Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s"
        max_runtime: 60000
        benchmarks: &MICRO_STEADY
            - Bounce:
                extra_args: "800 0 200"
            - BubbleSort:
                extra_args: "800 0 300"
            - Dispatch:
                extra_args: "800 0 2000"
            - Fannkuch:
                extra_args: "800 0 8"
            - Fibonacci:
                extra_args: "800 0 300"
            - FieldLoop:
                extra_args: "800 0 300"
            - IntegerLoop:
                extra_args: "800 0 800"
            - List:
                extra_args: "800 0 200"
            - Loop:
                extra_args: "800 0 1000"
            - Permute:
                extra_args: "800 0 300"
            - Queens:
                extra_args: "800 0 300"
            - QuickSort:
                extra_args: "800 0 300"
            - Recurse:
                extra_args: "800 0 300"
            - Sieve:
                extra_args: "800 0 500"
            - Storage:
                extra_args: "800 0 200"
            - Sum:
                extra_args: "800 0 1000"
            - Towers:
                extra_args: "800 0 200"
            - TreeSort:
                extra_args: "1500 0 100"
            - WhileLoop:
                extra_args: "800 0 3000"
        variable_values: *INLINING_VALUES                

    micro-steady-interp:
        gauge_adapter: RebenchLog
        command: *MICRO_CMD
        max_runtime: 60000
        benchmarks:
            - Bounce:
                extra_args: "200 0 40"
            - BubbleSort:
                extra_args: "200 0 60"
            - Dispatch:
                extra_args: "200 0 500"
            - Fannkuch:
                extra_args: "200 0 3"
            - Fibonacci:
                extra_args: "200 0 80"
            - FieldLoop:
                extra_args: "200 0 3"
            - IntegerLoop:
                extra_args: "200 0 8"
            - List:
                extra_args: "200 0 30"
            - Loop:
                extra_args: "200 0 100"
            - Permute:
                extra_args: "200 0 30"
            - Queens:
                extra_args: "200 0 30"
            - QuickSort:
                extra_args: "200 0 30"
            - Recurse:
                extra_args: "200 0 30"
            - Sieve:
                extra_args: "200 0 100"
            - Storage:
                extra_args: "200 0 100"
            - Sum:
                extra_args: "200 0 100"
            - Towers:
                extra_args: "200 0 100"
            - TreeSort:
                extra_args: "200 0 30"
            - WhileLoop:
                extra_args: "200 0 30"


    #Configuration of the SOM Mate microbenchmarks
    mop-individual-activation-steady:
        gauge_adapter: RebenchLog
        command: ":Examples/Benchmarks/Mate Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s "
        max_runtime: 60000
        benchmarks:
            - FieldRead:
                extra_args: "750 0 2000000"
            - FieldWrite:
                extra_args: "750 0 2000000"
            - MessageSend:
                extra_args: "750 0 2000000"
            - VMReflectiveFieldRead:
                extra_args: "750 0 2000000"
            - VMReflectiveFieldWrite:
                extra_args: "750 0 2000000"
            - VMReflectiveLayoutFieldWrite:
                extra_args: "750 0 2000000"
            - VMReflectiveLayoutFieldRead:
                extra_args: "750 0 2000000"
            - VMReflectiveMethodActivation:
                extra_args: "750 0 2000000"
            - VMReflectiveMessageSend:
                extra_args: "750 0 2000000"
            - AllOperations:
                extra_args: "750 0 2000000"    
        variable_values: *INLINING_VALUES           
    
    #Configuration of the Delegation Proxies for read only
    readonly:
        gauge_adapter: RebenchLog
        command: &READONLY_CMD ":Examples/Benchmarks/Mate:Examples/Benchmarks/Mate/DelegationProxies Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s "
        max_runtime: 60000
        benchmarks:
            - SumKeys:
                extra_args: "800 0 20"
            - DelegationProxiesSumKeys:
                extra_args: "800 0 20"
        variable_values: *INLINING_VALUES                
    
    readonly-interp:
        gauge_adapter: RebenchLog
        command: *READONLY_CMD
        max_runtime: 60000
        benchmarks:
            - SumKeys:
                extra_args: "200 0 5"
            - DelegationProxiesSumKeys:
                extra_args: "200 0 5"

    #Configuration of the Mate Handles for readonly
    readonly-Handles:
        gauge_adapter: RebenchLog
        command: &READONLYHANDLE_CMD ":Examples/Benchmarks/Mate:Examples/Benchmarks/Mate/DelegationProxies Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s "
        max_runtime: 60000
        benchmarks:
            - ReadonlySumKeys:
                extra_args: "800 0 20"
        variable_values: *INLINING_VALUES                
    
    readonly-Handles-interp:
        gauge_adapter: RebenchLog
        command: *READONLYHANDLE_CMD
        max_runtime: 60000
        benchmarks:
            - ReadonlySumKeys:
                extra_args: "200 0 5"

    mate-tracing:
        gauge_adapter: RebenchLog
        command: ":Examples/Benchmarks/DeltaBlue:Examples/Benchmarks/NBody:Examples/Benchmarks/DeltaBlueInstrumented:Examples/Benchmarks/Mate:Examples/Benchmarks/Mate/Tracing:Examples/Benchmarks/Json Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s "
        max_runtime: 60000
        benchmarks:
            - DeltaBlueMate:
                extra_args: "1500 0 1200"
            - NBodyMate:
                extra_args: "1500 0 50000"
            - JsonTrace:
                extra_args: "250 0 1"
            - QuickSortTrace:
                extra_args: "800 0 300"
        variable_values: *INLINING_VALUES                

    #Configuration of the Tracing Benchmarks
    standard-tracing:
        gauge_adapter: RebenchLog
        command: ":Examples/Benchmarks/DeltaBlue:Examples/Benchmarks/DeltaBlueInstrumented:Examples/Benchmarks/Mate/Tracing:Examples/Benchmarks/Json Examples/Benchmarks/BenchmarkHarness.som %(benchmark)s "
        max_runtime: 60000
        benchmarks:
            - DeltaBlueInstrumented:
                extra_args: "1500 0 1200"
            - JsonBig:
                extra_args: "250 0 1"
        variable_values: *INLINING_VALUES                
    
# VMs have a name and are specified by a path and the binary to be executed
virtual_machines:
    TruffleSOM-interpreter:
        path: .
        binary: som
        args: "-G -cp Smalltalk"
    TruffleSOM-graal:
        path: . 
        binary: som
        args: "-cp Smalltalk"
    TruffleSOM-graal-moreInlining:
        path: . 
        binary: som
        args: "-it %(variable)s -cp Smalltalk"
    TruffleMate-interpreter:
        path: . 
        binary: som
        args: "--mate -activateMate -G -cp Smalltalk:Smalltalk/Mate:Smalltalk/Mate/MOP"
    TruffleMate-graal:
        path: . 
        binary: som
        args: "--mate -activateMate -cp Smalltalk:Smalltalk/Mate:Smalltalk/Mate/MOP"
    TruffleMate-graal-moreInlining:
        path: . 
        binary: som
        args: "--mate -activateMate -it %(variable)s -cp Smalltalk:Smalltalk/Mate:Smalltalk/Mate/MOP"
    TruffleMate-graal-deactivated:
        path: . 
        binary: som
        args: "--mate -cp Smalltalk:Smalltalk/Mate:Smalltalk/Mate/MOP"
    TruffleMate-graal-deactivated-moreInlining:
        path: . 
        binary: som
        args: "--mate -it %(variable)s -cp Smalltalk:Smalltalk/Mate:Smalltalk/Mate/MOP"
        
# define the benchmarks to be executed for a re-executable benchmark run
experiments:

    #The results of this experiment are in Section X figures Y and Z (Section )
    ReflectiveVM-NoActivation:
        benchmark:
            - micro-steady
            - macro-steady
        executions:
            - TruffleSOM-graal-moreInlining
            - TruffleMate-graal-moreInlining
            - TruffleMate-graal-deactivated-moreInlining

    Interpreter:
        benchmark:
            - micro-steady-interp
            - macro-steady-interp
            - readonly-interp
            - readonly-Handles-interp
        executions:
            - TruffleSOM-interpreter
            - TruffleMate-interpreter
            
    #The results of this experiment are in Section X figures Y and Z (Section )
    ReflectiveVM-IndividualActivations:
        benchmark:
            - mop-individual-activation-steady
        executions:
            - TruffleMate-graal-moreInlining

    #The results of this experiment are in Section X figures Y and Z (Section )
    ReflectiveVM-Readonly-Scenario:
        benchmark:
            - readonly
            - readonly-Handles
        executions:
            - TruffleMate-graal-moreInlining

    SOM-Readonly-Scenario:
        benchmark:
            - readonly
        executions:
            - TruffleSOM-graal-moreInlining

    #The results of this experiment are in Section X figures Y and Z (Section )
    Standard-Tracing:
        benchmark:
            - standard-tracing
        executions:
            - TruffleSOM-graal-moreInlining

    Mate-Tracing:
        benchmark:
            - mate-tracing
        executions:
            - TruffleMate-graal-moreInlining